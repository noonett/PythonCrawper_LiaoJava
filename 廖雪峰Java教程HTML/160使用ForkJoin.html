<div class="uk-flex-item-1" style="padding-left:15px; ">
							<div id="x-content-top">
								<!-- __snippet__.contentTop -->
																<!-- // __snippet__.contentTop -->
							</div>
							<div id="x-content">
								    <h4>&#20351;&#29992;ForkJoin</h4>
    <div class="x-wiki-info">
    	<span>Reads: 9437</span>
    	<a href="/manage/wiki/wikipage_update?id=1306581226487842" target="_blank" class="x-can-edit uk-text-danger">Edit</a>
</div>

    <hr>

    <div class="x-wiki-content x-main-content">
<p>Java 7&#24320;&#22987;&#24341;&#20837;&#20102;&#19968;&#31181;&#26032;&#30340;Fork/Join&#32447;&#31243;&#27744;&#65292;&#23427;&#21487;&#20197;&#25191;&#34892;&#19968;&#31181;&#29305;&#27530;&#30340;&#20219;&#21153;&#65306;&#25226;&#19968;&#20010;&#22823;&#20219;&#21153;&#25286;&#25104;&#22810;&#20010;&#23567;&#20219;&#21153;&#24182;&#34892;&#25191;&#34892;&#12290;</p>
<p>&#25105;&#20204;&#20030;&#20010;&#20363;&#23376;&#65306;&#22914;&#26524;&#35201;&#35745;&#31639;&#19968;&#20010;&#36229;&#22823;&#25968;&#32452;&#30340;&#21644;&#65292;&#26368;&#31616;&#21333;&#30340;&#20570;&#27861;&#26159;&#29992;&#19968;&#20010;&#24490;&#29615;&#22312;&#19968;&#20010;&#32447;&#31243;&#20869;&#23436;&#25104;&#65306;</p>
<pre><code class="language-ascii">&#9484;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9488;
&#9492;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9496;
</code></pre>
<p>&#36824;&#26377;&#19968;&#31181;&#26041;&#27861;&#65292;&#21487;&#20197;&#25226;&#25968;&#32452;&#25286;&#25104;&#20004;&#37096;&#20998;&#65292;&#20998;&#21035;&#35745;&#31639;&#65292;&#26368;&#21518;&#21152;&#36215;&#26469;&#23601;&#26159;&#26368;&#32456;&#32467;&#26524;&#65292;&#36825;&#26679;&#21487;&#20197;&#29992;&#20004;&#20010;&#32447;&#31243;&#24182;&#34892;&#25191;&#34892;&#65306;</p>
<pre><code class="language-ascii">&#9484;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9488;
&#9492;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9496;
&#9484;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9488;
&#9492;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9496;
</code></pre>
<p>&#22914;&#26524;&#25286;&#25104;&#20004;&#37096;&#20998;&#36824;&#26159;&#24456;&#22823;&#65292;&#25105;&#20204;&#36824;&#21487;&#20197;&#32487;&#32493;&#25286;&#65292;&#29992;4&#20010;&#32447;&#31243;&#24182;&#34892;&#25191;&#34892;&#65306;</p>
<pre><code class="language-ascii">&#9484;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9488;
&#9492;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9496;
&#9484;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9488;
&#9492;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9496;
&#9484;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9488;
&#9492;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9496;
&#9484;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9516;&#9472;&#9488;
&#9492;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9524;&#9472;&#9496;
</code></pre>
<p>&#36825;&#23601;&#26159;Fork/Join&#20219;&#21153;&#30340;&#21407;&#29702;&#65306;&#21028;&#26029;&#19968;&#20010;&#20219;&#21153;&#26159;&#21542;&#36275;&#22815;&#23567;&#65292;&#22914;&#26524;&#26159;&#65292;&#30452;&#25509;&#35745;&#31639;&#65292;&#21542;&#21017;&#65292;&#23601;&#20998;&#25286;&#25104;&#20960;&#20010;&#23567;&#20219;&#21153;&#20998;&#21035;&#35745;&#31639;&#12290;&#36825;&#20010;&#36807;&#31243;&#21487;&#20197;&#21453;&#22797;&#8220;&#35010;&#21464;&#8221;&#25104;&#19968;&#31995;&#21015;&#23567;&#20219;&#21153;&#12290;</p>
<p>&#25105;&#20204;&#26469;&#30475;&#22914;&#20309;&#20351;&#29992;Fork/Join&#23545;&#22823;&#25968;&#25454;&#36827;&#34892;&#24182;&#34892;&#27714;&#21644;&#65306;</p>
<pre><code class="language-x-java">import java.util.Random;
import java.util.concurrent.*;
----
public class Main {
    public static void main(String[] args) throws Exception {
        // &#21019;&#24314;2000&#20010;&#38543;&#26426;&#25968;&#32452;&#25104;&#30340;&#25968;&#32452;:
        long[] array = new long[2000];
        long expectedSum = 0;
        for (int i = 0; i &lt; array.length; i++) {
            array[i] = random();
            expectedSum += array[i];
        }
        System.out.println("Expected sum: " + expectedSum);
        // fork/join:
        ForkJoinTask&lt;Long&gt; task = new SumTask(array, 0, array.length);
        long startTime = System.currentTimeMillis();
        Long result = ForkJoinPool.commonPool().invoke(task);
        long endTime = System.currentTimeMillis();
        System.out.println("Fork/join sum: " + result + " in " + (endTime - startTime) + " ms.");
    }

    static Random random = new Random(0);

    static long random() {
        return random.nextInt(10000);
    }
}

class SumTask extends RecursiveTask&lt;Long&gt; {
    static final int THRESHOLD = 500;
    long[] array;
    int start;
    int end;

    SumTask(long[] array, int start, int end) {
        this.array = array;
        this.start = start;
        this.end = end;
    }

    @Override
    protected Long compute() {
        if (end - start &lt;= THRESHOLD) {
            // &#22914;&#26524;&#20219;&#21153;&#36275;&#22815;&#23567;,&#30452;&#25509;&#35745;&#31639;:
            long sum = 0;
            for (int i = start; i &lt; end; i++) {
                sum += this.array[i];
                // &#25925;&#24847;&#25918;&#24930;&#35745;&#31639;&#36895;&#24230;:
                try {
                    Thread.sleep(1);
                } catch (InterruptedException e) {
                }
            }
            return sum;
        }
        // &#20219;&#21153;&#22826;&#22823;,&#19968;&#20998;&#20026;&#20108;:
        int middle = (end + start) / 2;
        System.out.println(String.format("split %d~%d ==&gt; %d~%d, %d~%d", start, end, start, middle, middle, end));
        SumTask subtask1 = new SumTask(this.array, start, middle);
        SumTask subtask2 = new SumTask(this.array, middle, end);
        invokeAll(subtask1, subtask2);
        Long subresult1 = subtask1.join();
        Long subresult2 = subtask2.join();
        Long result = subresult1 + subresult2;
        System.out.println("result = " + subresult1 + " + " + subresult2 + " ==&gt; " + result);
        return result;
    }
}
</code></pre>
<p>&#35266;&#23519;&#19978;&#36848;&#20195;&#30721;&#30340;&#25191;&#34892;&#36807;&#31243;&#65292;&#19968;&#20010;&#22823;&#30340;&#35745;&#31639;&#20219;&#21153;0~2000&#39318;&#20808;&#20998;&#35010;&#20026;&#20004;&#20010;&#23567;&#20219;&#21153;0~1000&#21644;1000~2000&#65292;&#36825;&#20004;&#20010;&#23567;&#20219;&#21153;&#20173;&#28982;&#22826;&#22823;&#65292;&#32487;&#32493;&#20998;&#35010;&#20026;&#26356;&#23567;&#30340;0~500&#65292;500~1000&#65292;1000~1500&#65292;1500~2000&#65292;&#26368;&#21518;&#65292;&#35745;&#31639;&#32467;&#26524;&#34987;&#20381;&#27425;&#21512;&#24182;&#65292;&#24471;&#21040;&#26368;&#32456;&#32467;&#26524;&#12290;</p>
<p>&#22240;&#27492;&#65292;&#26680;&#24515;&#20195;&#30721;<code>SumTask</code>&#32487;&#25215;&#33258;<code>RecursiveTask</code>&#65292;&#22312;<code>compute()</code>&#26041;&#27861;&#20013;&#65292;&#20851;&#38190;&#26159;&#22914;&#20309;&#8220;&#20998;&#35010;&#8221;&#20986;&#23376;&#20219;&#21153;&#24182;&#19988;&#25552;&#20132;&#23376;&#20219;&#21153;&#65306;</p>
<pre><code>class SumTask extends RecursiveTask&lt;Long&gt; {
    protected Long compute() {
        // &#8220;&#20998;&#35010;&#8221;&#23376;&#20219;&#21153;:
        SumTask subtask1 = new SumTask(...);
        SumTask subtask2 = new SumTask(...);
        // invokeAll&#20250;&#24182;&#34892;&#36816;&#34892;&#20004;&#20010;&#23376;&#20219;&#21153;:
        invokeAll(subtask1, subtask2);
        // &#33719;&#24471;&#23376;&#20219;&#21153;&#30340;&#32467;&#26524;:
        Long result1 = fork1.join();
        Long result2 = fork2.join();
        // &#27719;&#24635;&#32467;&#26524;:
        return result1 + result2;
    }
}
</code></pre>
<p>Fork/Join&#32447;&#31243;&#27744;&#22312;Java&#26631;&#20934;&#24211;&#20013;&#23601;&#26377;&#24212;&#29992;&#12290;Java&#26631;&#20934;&#24211;&#25552;&#20379;&#30340;<code>java.util.Arrays.parallelSort(array)</code>&#21487;&#20197;&#36827;&#34892;&#24182;&#34892;&#25490;&#24207;&#65292;&#23427;&#30340;&#21407;&#29702;&#23601;&#26159;&#20869;&#37096;&#36890;&#36807;Fork/Join&#23545;&#22823;&#25968;&#32452;&#20998;&#25286;&#36827;&#34892;&#24182;&#34892;&#25490;&#24207;&#65292;&#22312;&#22810;&#26680;CPU&#19978;&#23601;&#21487;&#20197;&#22823;&#22823;&#25552;&#39640;&#25490;&#24207;&#30340;&#36895;&#24230;&#12290;</p>
<h3>&#32451;&#20064;</h3>
<p><a href="https://gitee.com/liaoxuefeng/learn-java/raw/master/practices/Java%E6%95%99%E7%A8%8B/130.%E5%A4%9A%E7%BA%BF%E7%A8%8B.1255943750561472/190.%E4%BD%BF%E7%94%A8ForkJoin.1306581226487842/thread-forkjoin.zip">&#20351;&#29992;Fork/Join</a></p>
<h3>&#23567;&#32467;</h3>
<p>Fork/Join&#26159;&#19968;&#31181;&#22522;&#20110;&#8220;&#20998;&#27835;&#8221;&#30340;&#31639;&#27861;&#65306;&#36890;&#36807;&#20998;&#35299;&#20219;&#21153;&#65292;&#24182;&#34892;&#25191;&#34892;&#65292;&#26368;&#21518;&#21512;&#24182;&#32467;&#26524;&#24471;&#21040;&#26368;&#32456;&#32467;&#26524;&#12290;</p>
<p><code>ForkJoinPool</code>&#32447;&#31243;&#27744;&#21487;&#20197;&#25226;&#19968;&#20010;&#22823;&#20219;&#21153;&#20998;&#25286;&#25104;&#23567;&#20219;&#21153;&#24182;&#34892;&#25191;&#34892;&#65292;&#20219;&#21153;&#31867;&#24517;&#39035;&#32487;&#25215;&#33258;<code>RecursiveTask</code>&#25110;<code>RecursiveAction</code>&#12290;</p>
<p>&#20351;&#29992;Fork/Join&#27169;&#24335;&#21487;&#20197;&#36827;&#34892;&#24182;&#34892;&#35745;&#31639;&#20197;&#25552;&#39640;&#25928;&#29575;&#12290;</p>
</div>

    <hr>

    <div class="x-wiki-prev-next uk-clearfix"></div>

    <div class="x-anchor x-comment-anchor"><a name="comments"></a></div>
							</div>
							<div id="x-content-bottom">
								<!-- __snippet__.contentBottom -->
								<div id="sponsor-a" class="uk-margin-bottom"></div>
								<!-- // __snippet__.contentBottom -->
							</div>
							<div id="x-content-comment">
								    <h3>Comments</h3>

    <ul id="x-comment-list" class="uk-comment-list">
    </ul>

    <h3>Make a comment</h3>

    <div class="x-display-if-not-signin">
        <p><button type="button" class="uk-button" onclick="showSignin()"><i class="uk-icon-signin"></i> Sign in to make a comment</button></p>
    </div>

    <div id="x-comment-area"></div>

							</div>
						</div>
											
