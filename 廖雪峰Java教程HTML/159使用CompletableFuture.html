<div class="uk-flex-item-1" style="padding-left:15px; ">
							<div id="x-content-top">
								<!-- __snippet__.contentTop -->
																<!-- // __snippet__.contentTop -->
							</div>
							<div id="x-content">
								    <h4>&#20351;&#29992;CompletableFuture</h4>
    <div class="x-wiki-info">
    	<span>Reads: 9873</span>
    	<a href="/manage/wiki/wikipage_update?id=1306581182447650" target="_blank" class="x-can-edit uk-text-danger">Edit</a>
</div>

    <hr>

    <div class="x-wiki-content x-main-content">
<p>&#20351;&#29992;<code>Future</code>&#33719;&#24471;&#24322;&#27493;&#25191;&#34892;&#32467;&#26524;&#26102;&#65292;&#35201;&#20040;&#35843;&#29992;&#38459;&#22622;&#26041;&#27861;<code>get()</code>&#65292;&#35201;&#20040;&#36718;&#35810;&#30475;<code>isDone()</code>&#26159;&#21542;&#20026;<code>true</code>&#65292;&#36825;&#20004;&#31181;&#26041;&#27861;&#37117;&#19981;&#26159;&#24456;&#22909;&#65292;&#22240;&#20026;&#20027;&#32447;&#31243;&#20063;&#20250;&#34987;&#36843;&#31561;&#24453;&#12290;</p>
<p>&#20174;Java 8&#24320;&#22987;&#24341;&#20837;&#20102;<code>CompletableFuture</code>&#65292;&#23427;&#38024;&#23545;<code>Future</code>&#20570;&#20102;&#25913;&#36827;&#65292;&#21487;&#20197;&#20256;&#20837;&#22238;&#35843;&#23545;&#35937;&#65292;&#24403;&#24322;&#27493;&#20219;&#21153;&#23436;&#25104;&#25110;&#32773;&#21457;&#29983;&#24322;&#24120;&#26102;&#65292;&#33258;&#21160;&#35843;&#29992;&#22238;&#35843;&#23545;&#35937;&#30340;&#22238;&#35843;&#26041;&#27861;&#12290;</p>
<p>&#25105;&#20204;&#20197;&#33719;&#21462;&#32929;&#31080;&#20215;&#26684;&#20026;&#20363;&#65292;&#30475;&#30475;&#22914;&#20309;&#20351;&#29992;<code>CompletableFuture</code>&#65306;</p>
<pre><code class="language-x-java">// CompletableFuture
import java.util.concurrent.CompletableFuture;
----
public class Main {
    public static void main(String[] args) throws Exception {
        // &#21019;&#24314;&#24322;&#27493;&#25191;&#34892;&#20219;&#21153;:
        CompletableFuture&lt;Double&gt; cf = CompletableFuture.supplyAsync(Main::fetchPrice);
        // &#22914;&#26524;&#25191;&#34892;&#25104;&#21151;:
        cf.thenAccept((result) -&gt; {
            System.out.println("price: " + result);
        });
        // &#22914;&#26524;&#25191;&#34892;&#24322;&#24120;:
        cf.exceptionally((e) -&gt; {
            e.printStackTrace();
            return null;
        });
        // &#20027;&#32447;&#31243;&#19981;&#35201;&#31435;&#21051;&#32467;&#26463;&#65292;&#21542;&#21017;CompletableFuture&#40664;&#35748;&#20351;&#29992;&#30340;&#32447;&#31243;&#27744;&#20250;&#31435;&#21051;&#20851;&#38381;:
        Thread.sleep(2000);
    }

    static Double fetchPrice() {
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
        }
        if (Math.random() &lt; 0.3) {
            throw new RuntimeException("fetch price failed!");
        }
        return 5 + Math.random() * 20;
    }
}
</code></pre>
<p>&#21019;&#24314;&#19968;&#20010;<code>CompletableFuture</code>&#26159;&#36890;&#36807;<code>CompletableFuture.supplyAsync()</code>&#23454;&#29616;&#30340;&#65292;&#23427;&#38656;&#35201;&#19968;&#20010;&#23454;&#29616;&#20102;<code>Supplier</code>&#25509;&#21475;&#30340;&#23545;&#35937;&#65306;</p>
<pre><code>public interface Supplier&lt;T&gt; {
    T get();
}
</code></pre>
<p>&#36825;&#37324;&#25105;&#20204;&#29992;lambda&#35821;&#27861;&#31616;&#21270;&#20102;&#19968;&#19979;&#65292;&#30452;&#25509;&#20256;&#20837;<code>Main::fetchPrice</code>&#65292;&#22240;&#20026;<code>Main.fetchPrice()</code>&#38745;&#24577;&#26041;&#27861;&#30340;&#31614;&#21517;&#31526;&#21512;<code>Supplier</code>&#25509;&#21475;&#30340;&#23450;&#20041;&#65288;&#38500;&#20102;&#26041;&#27861;&#21517;&#22806;&#65289;&#12290;</p>
<p>&#32039;&#25509;&#30528;&#65292;<code>CompletableFuture</code>&#24050;&#32463;&#34987;&#25552;&#20132;&#32473;&#40664;&#35748;&#30340;&#32447;&#31243;&#27744;&#25191;&#34892;&#20102;&#65292;&#25105;&#20204;&#38656;&#35201;&#23450;&#20041;&#30340;&#26159;<code>CompletableFuture</code>&#23436;&#25104;&#26102;&#21644;&#24322;&#24120;&#26102;&#38656;&#35201;&#22238;&#35843;&#30340;&#23454;&#20363;&#12290;&#23436;&#25104;&#26102;&#65292;<code>CompletableFuture</code>&#20250;&#35843;&#29992;<code>Consumer</code>&#23545;&#35937;&#65306;</p>
<pre><code>public interface Consumer&lt;T&gt; {
    void accept(T t);
}
</code></pre>
<p>&#24322;&#24120;&#26102;&#65292;<code>CompletableFuture</code>&#20250;&#35843;&#29992;<code>Function</code>&#23545;&#35937;&#65306;</p>
<pre><code>public interface Function&lt;T, R&gt; {
    R apply(T t);
}
</code></pre>
<p>&#36825;&#37324;&#25105;&#20204;&#37117;&#29992;lambda&#35821;&#27861;&#31616;&#21270;&#20102;&#20195;&#30721;&#12290;</p>
<p>&#21487;&#35265;<code>CompletableFuture</code>&#30340;&#20248;&#28857;&#26159;&#65306;</p>
<ul>
<li>&#24322;&#27493;&#20219;&#21153;&#32467;&#26463;&#26102;&#65292;&#20250;&#33258;&#21160;&#22238;&#35843;&#26576;&#20010;&#23545;&#35937;&#30340;&#26041;&#27861;&#65307;</li>
<li>&#24322;&#27493;&#20219;&#21153;&#20986;&#38169;&#26102;&#65292;&#20250;&#33258;&#21160;&#22238;&#35843;&#26576;&#20010;&#23545;&#35937;&#30340;&#26041;&#27861;&#65307;</li>
<li>&#20027;&#32447;&#31243;&#35774;&#32622;&#22909;&#22238;&#35843;&#21518;&#65292;&#19981;&#20877;&#20851;&#24515;&#24322;&#27493;&#20219;&#21153;&#30340;&#25191;&#34892;&#12290;</li>
</ul>
<p>&#22914;&#26524;&#21482;&#26159;&#23454;&#29616;&#20102;&#24322;&#27493;&#22238;&#35843;&#26426;&#21046;&#65292;&#25105;&#20204;&#36824;&#30475;&#19981;&#20986;<code>CompletableFuture</code>&#30456;&#27604;<code>Future</code>&#30340;&#20248;&#21183;&#12290;<code>CompletableFuture</code>&#26356;&#24378;&#22823;&#30340;&#21151;&#33021;&#26159;&#65292;&#22810;&#20010;<code>CompletableFuture</code>&#21487;&#20197;&#20018;&#34892;&#25191;&#34892;&#65292;&#20363;&#22914;&#65292;&#23450;&#20041;&#20004;&#20010;<code>CompletableFuture</code>&#65292;&#31532;&#19968;&#20010;<code>CompletableFuture</code>&#26681;&#25454;&#35777;&#21048;&#21517;&#31216;&#26597;&#35810;&#35777;&#21048;&#20195;&#30721;&#65292;&#31532;&#20108;&#20010;<code>CompletableFuture</code>&#26681;&#25454;&#35777;&#21048;&#20195;&#30721;&#26597;&#35810;&#35777;&#21048;&#20215;&#26684;&#65292;&#36825;&#20004;&#20010;<code>CompletableFuture</code>&#23454;&#29616;&#20018;&#34892;&#25805;&#20316;&#22914;&#19979;&#65306;</p>
<pre><code class="language-x-java">// CompletableFuture
import java.util.concurrent.CompletableFuture;
----
public class Main {
    public static void main(String[] args) throws Exception {
        // &#31532;&#19968;&#20010;&#20219;&#21153;:
        CompletableFuture&lt;String&gt; cfQuery = CompletableFuture.supplyAsync(() -&gt; {
            return queryCode("&#20013;&#22269;&#30707;&#27833;");
        });
        // cfQuery&#25104;&#21151;&#21518;&#32487;&#32493;&#25191;&#34892;&#19979;&#19968;&#20010;&#20219;&#21153;:
        CompletableFuture&lt;Double&gt; cfFetch = cfQuery.thenApplyAsync((code) -&gt; {
            return fetchPrice(code);
        });
        // cfFetch&#25104;&#21151;&#21518;&#25171;&#21360;&#32467;&#26524;:
        cfFetch.thenAccept((result) -&gt; {
            System.out.println("price: " + result);
        });
        // &#20027;&#32447;&#31243;&#19981;&#35201;&#31435;&#21051;&#32467;&#26463;&#65292;&#21542;&#21017;CompletableFuture&#40664;&#35748;&#20351;&#29992;&#30340;&#32447;&#31243;&#27744;&#20250;&#31435;&#21051;&#20851;&#38381;:
        Thread.sleep(2000);
    }

    static String queryCode(String name) {
        try {
            Thread.sleep(500);
        } catch (InterruptedException e) {
        }
        return "601857";
    }

    static Double fetchPrice(String code) {
        try {
            Thread.sleep(500);
        } catch (InterruptedException e) {
        }
        return 5 + Math.random() * 20;
    }
}
</code></pre>
<p>&#38500;&#20102;&#20018;&#34892;&#25191;&#34892;&#22806;&#65292;&#22810;&#20010;<code>CompletableFuture</code>&#36824;&#21487;&#20197;&#24182;&#34892;&#25191;&#34892;&#12290;&#20363;&#22914;&#65292;&#25105;&#20204;&#32771;&#34385;&#36825;&#26679;&#30340;&#22330;&#26223;&#65306;</p>
<p>&#21516;&#26102;&#20174;&#26032;&#28010;&#21644;&#32593;&#26131;&#26597;&#35810;&#35777;&#21048;&#20195;&#30721;&#65292;&#21482;&#35201;&#20219;&#24847;&#19968;&#20010;&#36820;&#22238;&#32467;&#26524;&#65292;&#23601;&#36827;&#34892;&#19979;&#19968;&#27493;&#26597;&#35810;&#20215;&#26684;&#65292;&#26597;&#35810;&#20215;&#26684;&#20063;&#21516;&#26102;&#20174;&#26032;&#28010;&#21644;&#32593;&#26131;&#26597;&#35810;&#65292;&#21482;&#35201;&#20219;&#24847;&#19968;&#20010;&#36820;&#22238;&#32467;&#26524;&#65292;&#23601;&#23436;&#25104;&#25805;&#20316;&#65306;</p>
<pre><code class="language-x-java">// CompletableFuture
import java.util.concurrent.CompletableFuture;
----
public class Main {
    public static void main(String[] args) throws Exception {
        // &#20004;&#20010;CompletableFuture&#25191;&#34892;&#24322;&#27493;&#26597;&#35810;:
        CompletableFuture&lt;String&gt; cfQueryFromSina = CompletableFuture.supplyAsync(() -&gt; {
            return queryCode("&#20013;&#22269;&#30707;&#27833;", "https://finance.sina.com.cn/code/");
        });
        CompletableFuture&lt;String&gt; cfQueryFrom163 = CompletableFuture.supplyAsync(() -&gt; {
            return queryCode("&#20013;&#22269;&#30707;&#27833;", "https://money.163.com/code/");
        });

        // &#29992;anyOf&#21512;&#24182;&#20026;&#19968;&#20010;&#26032;&#30340;CompletableFuture:
        CompletableFuture&lt;Object&gt; cfQuery = CompletableFuture.anyOf(cfQueryFromSina, cfQueryFrom163);

        // &#20004;&#20010;CompletableFuture&#25191;&#34892;&#24322;&#27493;&#26597;&#35810;:
        CompletableFuture&lt;Double&gt; cfFetchFromSina = cfQuery.thenApplyAsync((code) -&gt; {
            return fetchPrice((String) code, "https://finance.sina.com.cn/price/");
        });
        CompletableFuture&lt;Double&gt; cfFetchFrom163 = cfQuery.thenApplyAsync((code) -&gt; {
            return fetchPrice((String) code, "https://money.163.com/price/");
        });

        // &#29992;anyOf&#21512;&#24182;&#20026;&#19968;&#20010;&#26032;&#30340;CompletableFuture:
        CompletableFuture&lt;Object&gt; cfFetch = CompletableFuture.anyOf(cfFetchFromSina, cfFetchFrom163);

        // &#26368;&#32456;&#32467;&#26524;:
        cfFetch.thenAccept((result) -&gt; {
            System.out.println("price: " + result);
        });
        // &#20027;&#32447;&#31243;&#19981;&#35201;&#31435;&#21051;&#32467;&#26463;&#65292;&#21542;&#21017;CompletableFuture&#40664;&#35748;&#20351;&#29992;&#30340;&#32447;&#31243;&#27744;&#20250;&#31435;&#21051;&#20851;&#38381;:
        Thread.sleep(2000);
    }

    static String queryCode(String name, String url) {
        System.out.println("query code from " + url + "...");
        try {
            Thread.sleep((long) (Math.random() * 1000));
        } catch (InterruptedException e) {
        }
        return "601857";
    }

    static Double fetchPrice(String code, String url) {
        System.out.println("query price from " + url + "...");
        try {
            Thread.sleep((long) (Math.random() * 1000));
        } catch (InterruptedException e) {
        }
        return 5 + Math.random() * 20;
    }
}
</code></pre>
<p>&#19978;&#36848;&#36923;&#36753;&#23454;&#29616;&#30340;&#24322;&#27493;&#26597;&#35810;&#35268;&#21017;&#23454;&#38469;&#19978;&#26159;&#65306;</p>
<pre><code class="language-ascii">&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488; &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474; Query Code  &#9474; &#9474; Query Code  &#9474;
&#9474;  from sina  &#9474; &#9474;  from 163   &#9474;
&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496; &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
       &#9474;               &#9474;
       &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
               &#9660;
        &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
        &#9474;    anyOf    &#9474;
        &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
               &#9474;
       &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9524;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
       &#9660;                &#9660;
&#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;  &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
&#9474; Query Price &#9474;  &#9474; Query Price &#9474;
&#9474;  from sina  &#9474;  &#9474;  from 163   &#9474;
&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;  &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
       &#9474;                &#9474;
       &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9516;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
                &#9660;
         &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
         &#9474;    anyOf    &#9474;
         &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
                &#9474;
                &#9660;
         &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
         &#9474;Display Price&#9474;
         &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
</code></pre>
<p>&#38500;&#20102;<code>anyOf()</code>&#21487;&#20197;&#23454;&#29616;&#8220;&#20219;&#24847;&#20010;<code>CompletableFuture</code>&#21482;&#35201;&#19968;&#20010;&#25104;&#21151;&#8221;&#65292;<code>allOf()</code>&#21487;&#20197;&#23454;&#29616;&#8220;&#25152;&#26377;<code>CompletableFuture</code>&#37117;&#24517;&#39035;&#25104;&#21151;&#8221;&#65292;&#36825;&#20123;&#32452;&#21512;&#25805;&#20316;&#21487;&#20197;&#23454;&#29616;&#38750;&#24120;&#22797;&#26434;&#30340;&#24322;&#27493;&#27969;&#31243;&#25511;&#21046;&#12290;</p>
<p>&#26368;&#21518;&#25105;&#20204;&#27880;&#24847;<code>CompletableFuture</code>&#30340;&#21629;&#21517;&#35268;&#21017;&#65306;</p>
<ul>
<li>
<code>xxx()</code>&#65306;&#34920;&#31034;&#35813;&#26041;&#27861;&#23558;&#32487;&#32493;&#22312;&#24050;&#26377;&#30340;&#32447;&#31243;&#20013;&#25191;&#34892;&#65307;</li>
<li>
<code>xxxAsync()</code>&#65306;&#34920;&#31034;&#23558;&#24322;&#27493;&#22312;&#32447;&#31243;&#27744;&#20013;&#25191;&#34892;&#12290;</li>
</ul>
<h3>&#32451;&#20064;</h3>
<p><a href="https://gitee.com/liaoxuefeng/learn-java/raw/master/practices/Java%E6%95%99%E7%A8%8B/130.%E5%A4%9A%E7%BA%BF%E7%A8%8B.1255943750561472/180.%E4%BD%BF%E7%94%A8CompletableFuture.1306581182447650/thread-completablefuture.zip">&#20351;&#29992;CompletableFuture</a></p>
<h3>&#23567;&#32467;</h3>
<p><code>CompletableFuture</code>&#21487;&#20197;&#25351;&#23450;&#24322;&#27493;&#22788;&#29702;&#27969;&#31243;&#65306;</p>
<ul>
<li>
<code>thenAccept()</code>&#22788;&#29702;&#27491;&#24120;&#32467;&#26524;&#65307;</li>
<li>
<code>exceptional()</code>&#22788;&#29702;&#24322;&#24120;&#32467;&#26524;&#65307;</li>
<li>
<code>thenApplyAsync()</code>&#29992;&#20110;&#20018;&#34892;&#21270;&#21478;&#19968;&#20010;<code>CompletableFuture</code>&#65307;</li>
<li>
<code>anyOf()</code>&#21644;<code>allOf()</code>&#29992;&#20110;&#24182;&#34892;&#21270;&#22810;&#20010;<code>CompletableFuture</code>&#12290;</li>
</ul>
</div>

    <hr>

    <div class="x-wiki-prev-next uk-clearfix"></div>

    <div class="x-anchor x-comment-anchor"><a name="comments"></a></div>
							</div>
							<div id="x-content-bottom">
								<!-- __snippet__.contentBottom -->
								<div id="sponsor-a" class="uk-margin-bottom"></div>
								<!-- // __snippet__.contentBottom -->
							</div>
							<div id="x-content-comment">
								    <h3>Comments</h3>

    <ul id="x-comment-list" class="uk-comment-list">
    </ul>

    <h3>Make a comment</h3>

    <div class="x-display-if-not-signin">
        <p><button type="button" class="uk-button" onclick="showSignin()"><i class="uk-icon-signin"></i> Sign in to make a comment</button></p>
    </div>

    <div id="x-comment-area"></div>

							</div>
						</div>
											
